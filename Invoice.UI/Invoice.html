<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
    <script src="https://cdn.ckeditor.com/ckeditor5/26.0.0/classic/ckeditor.js"></script>
    <title>Invoice</title>
    <body>
  </head>
    <div class="container mt-3 mb-3">
      <div class="row">
        <div class="col-1 bg-success rounded text-center text-light">Paid</div>
        <div class="col font-weight-bold">Bill</div>
        <div class="col-md-left">
          <img src="../img/heartbeat.jpg" />
        </div>
      </div>
      <div class="row">
        <input
          type="text"
          class="col-sm-6 form-control mt-3"
          value="Please Find attached your invoice. Thank you for timely payment"
        />
      </div>
      <div class="row mt-3">
          <div class="col-sm-0">
              <label for="noInvoiceLabel">No Invoice</label>
              <div class="input-group input-group-sm mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="inputGroup-sizing-sm">#</span>
                </div>
                <input
                  type="text"
                  class="form-control"
                  aria-label="Sizing example input"
                  aria-describedby="inputGroup-sizing-sm"
                  id="txt_noInvoice"
                />
              </div>
          </div> 

          <div class="col-sm-3 offset-md-2">
                <div class="form-group">
                    <label for="language">Language</label>
                    <select class="form-control" id="select_language">
                    </select>
                </div>
              </div>
              
                <div class="col-sm-3">
                    <div class="form-group">
                        <label for="currency">Currency</label>
                        <select class="form-control" id="select_currency">
                        </select>
                    </div>
                </div>

        <hr style="width:100%;text-align:left;margin-left:0">

        <div class="row mt-3">
            <div class="form-group row">
                <div class="col-md-8">
                  <label for="sender">From</label>
                    <textarea class="form-control" id="txt_sender" name="txtSender" rows="4" cols="50"></textarea>
                    <button type="reset" id="btnResetSender" onclick="btnResetSenderOnClick()" class="btn btn-secondary mt-2">Reset</button>
                </div>
                <div class="col-md-4">
                  <label for="date">Date</label>
                  <input placeholder="Date" type="date" id="invoice_date" class=" form-control">
                  <label for="dueDate">Due Date</label>
                  <input placeholder="Due Date" type="date" id="invoice_dueDate" class=" form-control">
                </div>
            </div>

            <div class="form-group row">
              <div class="col">
                <label for="Recipient">To</label>
                  <select class="form-control mb-2" id="select_customers" onchange="onCustomerChange()">
                  </select>
                <textarea class="form-control" id="txt_address" name="Address" rows="4" cols="50"></textarea>
              </div>
              <div class="col-md-4">
                <label for="NomorPO">Purchase Order Number</label>
                  <!-- <select class="form-control mb-2" id="dropdown_poNumber">
                    <option>PO-01</option>
                  </select> -->
                  <input type="text" name="PONumber" id="txt_poNumber" data-toggle="modal" data-target="#exampleModalScrollable" onClick="getPOValue()">
              </div>
            </div>

        </div>

        <hr style="width:100%;text-align:left;margin-left:0"> 

        <div class="row mt-3">
          <div class="col-4">
            <label for="ContentName">Name</label>
            <textarea class="form-control" id="txt_contentName" name="ContentName" rows="4" cols="50"></textarea>
            <button type="button" id="btnNewLine" onclick="btnNewLineOnClick()" class="btn btn-info mt-2">New Line</button>
          </div>
          <div class="col">
            <label for="Quantity">Quantity</label>
            <input type="text" name="Quantity" id="txt_quantity" class="form-control">
          </div>
          <div class="col">
            <label for="ContentName">Rate</label>
            <input type="text" name="Rate" id="txt_rate" class="form-control">
            <select class="form-control mt-2" id="select_rate">
             <option>hour</option>
             <option>day</option>
            </select>
          </div>
          <div class="col">
            <label for="Amount">Amount</label>
            <input type="text" name="Amount" id="txt_amount" class="form-control">
          </div>
        </div>

      </div>

      <div class="d-flex justify-content-lg-end">
          <div class="row">
            <div class="col">
              <label for="subtotal">Sub Total</label>
              <div class="input-group">
                <input type="text" name="DiscountName" id="txt_discountName" placeholder="Enter Discount" class="form-control mt-4">
                <input type="text" name="DiscountPersentation" id="txt_discountPersentation" class="form-control mt-4">
              </div>
              <label for="Total" class="mt-4">Total</label>
            </div>
            
            <div class="col">
              <input type="text" name="SubTotal" id="txt_subtotal" class="form-control">
              <input type="text" name="Discount" id="txt_discount" class="form-control mt-3">
              <input type="text" name="Total" id="txt_total" class="form-control mt-3">
            </div>
          </div>
      </div>

      <!-- Button trigger modal -->
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalScrollable">
        Launch demo modal
      </button>

      <!-- Modal -->
      <div class="modal fade" id="exampleModalScrollable" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalScrollableTitle">Modal title</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <table class="table" id="exampleTable">
                <thead id="exampleThead">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">First</th>
                    <th scope="col">Last</th>
                    <th scope="col">Handle</th>
                  </tr>
                </thead>
                <tbody id="exampleTBody">
                  <tr>
                    <th scope="row">1</th>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Larry</td>
                    <td>the Bird</td>
                    <td>@twitter</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </body>
</html>

<script>
  window.onload = onPageLoaded();
  function onPageLoaded() {
    localStorage.clear();
    getAllProps();
    setCKEditor();    
  }

  function setCKEditor() {
    ClassicEditor
            .create( document.querySelector( '#txt_contentName' ) )
            .catch( error => {
                console.error( error );
            } );
  }

  async function getAllProps() {
    const data = await fetch("https://localhost:5001/api/Invoice/GetAllProps", {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        });

    const dataProps = await data.json();
    var rawData = JSON.stringify(dataProps);
    localStorage.setItem('data', rawData);
    onSelectLanguage();
    onSelectCurrency();
    onSelectCustomer();
    setNoInvoice();
  }

  function btnResetSenderOnClick() {
    document.getElementById('txt_sender').value = ''
  }

  function btnNewLineOnClick() {
    console.log('new line');
  }

  function onSelectCurrency() {
    var jsonData = JSON.parse(localStorage.data);
    var currencies = jsonData.value.currencies;
    var cr = currencies.map(a => a.currency);
    var el = document.getElementById('select_currency');
    cr.forEach(function(key, index) {
      var opt = document.createElement("option");
      opt.value = key;
      opt.innerHTML = key;
      el.appendChild(opt);
    });
  }

  function onSelectLanguage() {
    var jsonData = JSON.parse(localStorage.data);
    var lang = jsonData.value.language;
    var cr = lang.map(a => a.language);
    var el = document.getElementById('select_language');
    cr.forEach(function(key, index) {
      var opt = document.createElement("option");
      opt.value = key;
      opt.innerHTML = key;
      el.appendChild(opt);
    });
  }

  function onSelectCustomer() {
    var jsonData = JSON.parse(localStorage.data);
    var cust = jsonData.value.customers;
    var cr = cust.map(a => a.name);
    var el = document.getElementById('select_customers');
    cr.forEach(function(key, index) {
      var opt = document.createElement("option");
      opt.value = cust[index].id;
      opt.innerHTML = key;
      el.appendChild(opt);
    });
  }

  function setNoInvoice() {
    var jsonData = JSON.parse(localStorage.data);
    document.getElementById('txt_noInvoice').value = jsonData.value.noInvoice;
  }

  function onCustomerChange() {
    var jsonData = JSON.parse(localStorage.data);
    var cust = jsonData.value.customers;
    var newValue = document.getElementById('select_customers').value;
    var adr = cust.filter(a => a.id == parseInt(newValue));
    document.getElementById('txt_address').value = adr[0].address;
  }

  function getPOValue() {
    debugger;
      var table = document.getElementsByTagName("table")[0];
      var tbody = table.getElementsByTagName("tbody")[0];
      tbody.onclick = function (e) {
      e = e || window.event;
      var data = [];
      var target = e.srcElement || e.target;
      while (target && target.nodeName !== "TR") {
          target = target.parentNode;
      }
      if (target) {
          var cells = target.getElementsByTagName("td");
          for (var i = 0; i < cells.length; i++) {
              data.push(cells[i].innerHTML);
          }
      }
      alert(data);
      }
  }

</script>